<!DOCTYPE html>
<html lang="pl">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Animacja Paska z Itemami na Canvas</title>
        <style>
            body{
                font-family: Arial, sans-serif;
                display: flex;
                align-items: center;
                justify-content: center;
                height: 100vh;
                margin: 0;
                background-color: grey;
            }

            canvas{
                border-radius: 8px;
                width: 1000px;
                height: 200px;
            }
        </style>
    </head>
    <body>
        <canvas id="myCanvas"></canvas>

        <script>
            const lo = console.log;
            const canvas = document.querySelector("#myCanvas");
            const ctx = canvas.getContext("2d");
            canvas.width = 1000;
            canvas.height = 200;

            const pos = [
                { name: 'item1', per: 50 },
                { name: 'item2', per: 22 },
                { name: 'item3', per: 13.5 },
                { name: 'item4', per: 13 },
                { name: 'item5', per: 1.5 },
            ];
            const res = "item3";
            display(pos, res);
            
            function display(possibilities, result){
                const resultIndex = 45;
                const availableItems = generateItems(possibilities, resultIndex);
                const itemImg = {};
                loadImg();

                function generateItems(possibilities, resultIndex){
                    const items = [];
                    const totalProbability = possibilities.reduce((sum, option) => sum + option.per, 0);

                    for(let i=1; i<=50; i++){
                        const randomValue = Math.random() * totalProbability;
                        let cumulativeProbability = 0;

                        for(const option of possibilities){
                            cumulativeProbability += option.per;

                            if(randomValue <= cumulativeProbability){
                                items.push(option.name);
                                break;
                            }
                        }
                    }

                    items[resultIndex] = result;
                    return items;
                }

                function loadImg(){
                    for(let i=0; i<possibilities.length; i++){
                        const img = new Image();
                        img.src = location.origin + "/cases/" + possibilities[i].name + ".png";
                        itemImg[possibilities[i].name] = img;
                    }
                }

                function drawItems(x){
                    ctx.clearRect(0, 0, canvas.width, canvas.height);

                    for(let i=0; i<availableItems.length; i++){
                        const itemX = x + i * 200;
                        const item = availableItems[i];
                        const img = itemImg[item];
                        ctx.fillStyle = i % 2 == 0 ? "#f0f0f0" : "#e0e0e0";
                        ctx.fillRect(itemX, 0, 200, 200);
                        ctx.drawImage(img, itemX+25, 25, 150, 150);
                    }

                    ctx.strokeStyle = '#000';
                    ctx.lineWidth = 4;
                    ctx.beginPath();
                    const middleX = canvas.width / 2;
                    ctx.moveTo(middleX, 0);
                    ctx.lineTo(middleX, canvas.height);
                    ctx.stroke();
                }

                function rand(min, max){
                    if(min > max) [min, max] = [max, min];
                    return Math.floor(Math.random() * (max - min + 1)) + min;
                }

                function animate(){
                    let x = 0;
                    let speed = 41.2; // 2 - 6
                    speed += rand(0, 4) / 10;
                    
                    let acceleration = 0.1;

                    function update(){
                        drawItems(x);
                        x -= speed;

                        if(speed > 0.1) speed -= acceleration;
                        else speed = 0;

                        requestAnimationFrame(update);
                    }

                    update();
                }

                animate();
            }
        </script>
    </body>
</html>